/*! multi.js 21-06-2019 */

var multi=function(){var e=function(e,t){var a=t.limit;if(a>-1){for(var n=0,i=0;i<e.options.length;i++)e.options[i].selected&&n++;if(n===a){this.disabled_limit=!0,"function"==typeof t.limit_reached&&t.limit_reached();for(i=0;i<e.options.length;i++){(r=e.options[i]).selected||r.setAttribute("disabled",!0)}}else if(this.disabled_limit){for(i=0;i<e.options.length;i++){var r;"false"===(r=e.options[i]).getAttribute("data-origin-disabled")&&r.removeAttribute("disabled")}this.disabled_limit=!1}}},t=function(t,a,n){var i,r,l,d=t.options[a.getAttribute("multi-index")];d.disabled||(d.selected=!d.selected,e(t,n),i="change",r=t,(l=document.createEvent("HTMLEvents")).initEvent(i,!1,!0),r.dispatchEvent(l))},a=function(t,a){if(t.wrapper.selected.innerHTML="",t.wrapper.non_selected.innerHTML="",a.non_selected_header&&a.selected_header){var n=document.createElement("div"),i=document.createElement("div");n.className="header",i.className="header",n.innerText=a.non_selected_header,i.innerText=a.selected_header,t.wrapper.non_selected.appendChild(n),t.wrapper.selected.appendChild(i)}if(t.wrapper.search)var r=t.wrapper.search.value;var l=null,d=null;e(t,a);for(var s=0;s<t.options.length;s++){var o=t.options[s],c=o.value,p=o.textContent||o.innerText,u=document.createElement("a");if(u.tabIndex=0,u.className="item",u.innerHTML=p,u.setAttribute("role","button"),u.setAttribute("data-value",c),u.setAttribute("multi-index",s),o.disabled&&(u.className+=" disabled"),o.selected){u.className+=" selected";var m=u.cloneNode(!0);t.wrapper.selected.appendChild(m)}if("OPTGROUP"==o.parentNode.nodeName&&o.parentNode!=d){if(d=o.parentNode,(l=document.createElement("div")).className="item-group",o.parentNode.label){var h=document.createElement("span");h.innerHTML=o.parentNode.label,h.className="group-label",l.appendChild(h)}t.wrapper.non_selected.appendChild(l)}o.parentNode==t&&(l=null,d=null),(!r||r&&p.toLowerCase().indexOf(r.toLowerCase())>-1)&&(null!=l?l.appendChild(u):t.wrapper.non_selected.appendChild(u))}};return function(e,n){if((n=void 0!==n?n:{}).enable_search=void 0===n.enable_search||n.enable_search,n.search_placeholder=void 0!==n.search_placeholder?n.search_placeholder:"Search...",n.non_selected_header=void 0!==n.non_selected_header?n.non_selected_header:null,n.selected_header=void 0!==n.selected_header?n.selected_header:null,n.limit=void 0!==n.limit?parseInt(n.limit):-1,isNaN(n.limit)&&(n.limit=-1),null==e.dataset.multijs&&"SELECT"==e.nodeName&&e.multiple){e.style.display="none",e.setAttribute("data-multijs",!0);var i=document.createElement("div");if(i.className="multi-wrapper",n.enable_search){var r=document.createElement("input");r.className="search-input",r.type="text",r.setAttribute("placeholder",n.search_placeholder),r.addEventListener("input",function(){a(e,n)}),i.appendChild(r),i.search=r}var l=document.createElement("div");l.className="non-selected-wrapper";var d=document.createElement("div");d.className="selected-wrapper",i.addEventListener("click",function(a){var i=a.target.closest("a")||a.target;i.getAttribute("multi-index")&&t(e,i,n)}),i.addEventListener("keypress",function(a){var i=a.target.closest("a")||a.target,r=32===a.keyCode||13===a.keyCode;i.getAttribute("multi-index")&&r&&(a.preventDefault(),t(e,i,n))}),i.appendChild(l),i.appendChild(d),i.non_selected=l,i.selected=d,e.wrapper=i,e.parentNode.insertBefore(i,e.nextSibling);for(var s=0;s<e.options.length;s++){var o=e.options[s];o.setAttribute("data-origin-disabled",o.disabled)}a(e,n),e.addEventListener("change",function(){a(e,n)})}}}();"undefined"!=typeof jQuery&&function(e){e.fn.multi=function(t){return t=void 0!==t?t:{},this.each(function(){var a=e(this);multi(a.get(0),t)})}}(jQuery);export default multi;